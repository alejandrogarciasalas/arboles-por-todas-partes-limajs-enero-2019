import { Appear, Head } from 'mdx-deck'
import { FullScreenCode, Invert, Split } from 'mdx-deck/layouts'
import { Flex, Box } from 'reflexbox'

export { yellow as theme } from 'mdx-deck/themes'

<Head>
  <title>Árboles por todas partes: cómo librerias populares de JavaScript hacen uso de los ASTs</title>
</Head>

# Árboles por todas partes
## cómo librerias populares de JavaScript hacen uso de los ASTs
---

## Sobre mí
<Flex p={2} justify='left'>
  <Box px={1} w={2/3}>
  <ul>
    <li>Estudiante de Computer Science en Berkeley</li>
    <li>He hechos internships en Pinterest y Airbnb trabajando en diferetens partes del stack</li>
    <li>Fui voluntario y después instructor en Laboratoria</li>
    <li>Aprendí a programar haciendo juegos para iPhone</li>
  </ul>
  </Box>
  <Box px={1} w={1/3}>
    <img src="https://www.rforcats.net/assets/img/programmer.png" alt="programmer-cat" />
  </Box>
</Flex>

---

## ¿Qué es un AST?
AST o Abstract Syntax Tree "es una representación de árbol de la estructura sintáctica simplificada del código fuente escrito en cierto lenguaje de programación."
–[Wikipedia](https://es.wikipedia.org/wiki/%C3%81rbol_de_sintaxis_abstracta)

```notes
En resumén es una forma de representar código en un árbol
```
---

##  ¿Repaso: que es un Árbol?
![binary-tree](https://upload.wikimedia.org/wikipedia/commons/f/f7/Binary_tree.svg)

Ejemplos de Árboles en programación:
* Document Object Model (DOM)
* Sistema de Archivos
* Árbol de dependencia

---

## ¿Como conseguimos el AST?
Source Code -> Parser -> Tree

---
export default Split

```js
function foo(d) {
  d += 3;
    return d+999
}
function bar(d) {
    return d*100
}
```
![javascript-visualizer](https://i.stack.imgur.com/A9SZd.png)

---
## ¿Como funcionan los ASTs en JavaScript?

* Diferentes Parsers en JavaScript: [Acorn](https://github.com/acornjs/acorn), [Esprima](http://esprima.org/), [ESpree](https://github.com/eslint/espree) etc.
* Todos los parsers siguen el [ESTree Spec](https://github.com/estree/estree)
* Demo: [AST Explorer](https://astexplorer.net/)

### Todos los APIs son similares

```js
tree = acorn.parse("console.log('limajs'));```
```


``` notes
Espree es inspirado en esprima y construido sobre acorn.
Eslint usa Espree
Babel Parser (formerly babylon) esta basado en acorn.
```

---

## Usos de ASTs
* Compiladores e Interpretes
* Transformaciones de código en build-time (ejemplo: Babel, minifier)
* migración de código (ejemplo: Codeshift)
* Inspección de código (ejemplo: eslint)
---

## Demo: Crear un Babel Plugin

---
## ¿Para que es Babel?

Babel es un Transpilador de JavaScript

ES6(2015)
```js
[1, 2, 3].map(n => n ** 2);
```

ES5
```js
[1, 2, 3].map(function (n) {
 Math.pow(n, 2);
});
```

---
## Como funciona Babel?
![https://www.sitepoint.com/understanding-asts-building-babel-plugin/](https://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2016/04/1459949808babel.png)

[Creditos: Understanding ASTs by Building Your Own Babel Plugin](https://www.sitepoint.com/understanding-asts-building-babel-plugin/)

---
## Parse

[@babel/parser](https://babeljs.io/docs/en/babel-parser) (antes llamado Babylon) lee el codigo fuente y lo convierte en un AST

```js
require("@babel/parser").parse("code", {
  // parse in strict mode and allow module declarations
  sourceType: "module",

  plugins: [
    // enable jsx and flow syntax
    "jsx",
    "flow"
  ]
});
```


---
## Transform
Este paso usa [@babel/traverse](https://babeljs.io/docs/en/babel-traverse)  y es responsable de encotrar, remplazar, remover o añadir nodos al AST.

```js
import * as parser from "@babel/parser";
import traverse from "@babel/traverse";

const code = `function square(n) {
  return n * n;
}`;

const ast = parser.parse(code);

traverse(ast, {
  enter(path) {
    if (path.isIdentifier({ name: "n" })) {
      path.node.name = "x";
    }
  }
});
```
---
## Traversing the tree
ejemplo: pre-order traversal
![pre-order-traversal](https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/Sorted_binary_tree_inorder.svg/400px-Sorted_binary_tree_inorder.svg.png)

---
## Generate
[@babel/generator](https://babeljs.io/docs/en/babel-generator) Convierte el AST transformado de vuelta a código

```js
import {parse} from '@babel/parser';
import generate from '@babel/generator';

const code = 'class Example {}';
const ast = parse(code);

const output = generate(ast, { /* options */ }, code);
```

---

## Creditos
Charla inspirada por
* [Jamund Ferguson: Harnessing The Power of Abstract Syntax Trees | UtahJS 2015](https://www.youtube.com/watch?v=8uOXIM4giH8&t=444s)
* [Yonatan Mevorach: Master the Art of the AST and Take Control of Your JS | Full Stack Fest 2017](https://www.youtube.com/watch?v=C06MohLG_3s&t=728s)
* [Sebastian McKenzie: JavaScript Transformation | JSConf US 2015](https://www.youtube.com/watch?v=rKuNbEwoQfQ&t=1009s)

[Documentación de Babel](https://babeljs.io/docs/)
